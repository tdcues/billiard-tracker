<!-- rds.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <title>RDS Practice Log</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen p-4 md:p-8">
  <div class="max-w-5xl mx-auto bg-white shadow-md rounded p-4 md:p-8">

    <!-- Navigation -->
    <div class="flex justify-between items-center mb-4">
      <a href="dashboard.html" class="text-blue-600 hover:underline text-sm">&larr; Back to Dashboard</a>
      <h1 class="text-xl md:text-2xl font-bold text-center flex-grow">RDS Practice Log</h1>
    </div>

    <!-- Synopsis Table -->
    <div class="overflow-x-auto mb-8">
      <h2 class="text-lg font-semibold mb-2">Run-Out Drill System (RDS) Summary</h2>
      <p class="mb-4">Always take ball in hand immediately after the break, scratch on break is allowed. Start with level 6. Advance to next level if you win 2 of 3 racks, drop to previous level if you lose 3 in a row, otherwise continue to shoot at current level. You get additional BiH (ball in hand) on levels 2 - 9.</p>
      <table class="min-w-full text-sm border">
        <thead>
          <tr class="bg-gray-200">
            <th class="border px-2 py-1">Level</th>
            <th class="border px-2 py-1">Rack</th>
            <th class="border px-2 py-1">Required Balls</th>
            <th class="border px-2 py-1">Rules</th>
            <th class="border px-2 py-1">Extra BiH</th>
          </tr>
        </thead>
        <tbody>
          <tr><td class="border px-2 py-1">1</td><td class="border px-2 py-1"><img src="rds/a.jpg" alt="Rack A" class="w-12"></td><td class="border px-2 py-1">Any 6</td><td class="border px-2 py-1">No cue ball (call)</td><td class="border px-2 py-1"></td></tr>
          <tr><td>2</td><td><img src="rds/a.jpg" class="w-12"></td><td>Any 6</td><td>Any order (call)</td><td>5</td></tr>
          <tr><td>3</td><td><img src="rds/a.jpg" class="w-12"></td><td>Any 6</td><td>Any order (call)</td><td>3</td></tr>
          <tr><td>4</td><td><img src="rds/a.jpg" class="w-12"></td><td>Any 6</td><td>Any order (call)</td><td>2</td></tr>
          <tr><td>5</td><td><img src="rds/a.jpg" class="w-12"></td><td>Any 6</td><td>Any order (call)</td><td>1</td></tr>
          <tr><td>6</td><td><img src="rds/b.jpg" class="w-12"></td><td>3 stripes or 3 solids & 8</td><td>8-ball (call) + rotation (slop)</td><td>1</td></tr>
          <tr><td>7</td><td><img src="rds/c.jpg" class="w-12"></td><td>Any 9</td><td>Any order (call)</td><td>1</td></tr>
          <tr><td>8</td><td><img src="rds/d.jpg" class="w-12"></td><td>4 stripes or 4 solids & 8</td><td>8-ball (call) + rotation (slop)</td><td>1</td></tr>
          <tr><td>9</td><td><img src="rds/e.jpg" class="w-12"></td><td>All 15</td><td>Any order (call)</td><td>2</td></tr>
          <tr><td>10</td><td><img src="rds/a.jpg" class="w-12"></td><td>Any 6</td><td>Rotation (slop)</td><td></td></tr>
          <tr><td>11</td><td><img src="rds/e.jpg" class="w-12"></td><td>All 15</td><td>Any order (call)</td><td></td></tr>
          <tr><td>12</td><td><img src="rds/e.jpg" class="w-12"></td><td>All solids or stripes + 8</td><td>(call)</td><td></td></tr>
          <tr><td>13</td><td><img src="rds/d.jpg" class="w-12"></td><td>4 stripes or 4 solids & 8</td><td>8-ball (call) + rotation (slop)</td><td></td></tr>
          <tr><td>14</td><td><img src="rds/c.jpg" class="w-12"></td><td>Ball 1 - 9</td><td>Rotation (slop)</td><td></td></tr>
          <tr><td>15</td><td><img src="rds/e.jpg" class="w-12"></td><td>All 15</td><td>8-ball (call) + rotation (slop)</td><td></td></tr>
          <tr><td>16</td><td><img src="rds/e.jpg" class="w-12"></td><td>All 15</td><td>Rotation (slop)</td><td></td></tr>
        </tbody>
      </table>
      <p class="text-xs text-gray-500 mt-2">Adapted from the RDS handout by Dr. Dave Alciatore and Shane McEwan. Used with acknowledgment. See: <a href="https://drdavepoolinfo.com/resource_files/RDS_handout.pdf" class="text-blue-500 underline" target="_blank">Original PDF</a></p>
    </div>

    <!-- Entry Form -->
    <form id="rds-form" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
      <input type="date" id="date" required class="border p-2 rounded">
      <input type="time" id="time" required class="border p-2 rounded">
      <input type="text" id="level" placeholder="Level Achieved" class="border p-2 rounded">
      <input type="text" id="location" placeholder="Table/Place" class="border p-2 rounded">
      <input type="text" id="notes" placeholder="Notes" class="border p-2 rounded col-span-1 md:col-span-3">
      <button type="submit" class="col-span-1 md:col-span-3 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Add Entry</button>
    </form>

    <!-- Entries Table -->
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white border">
        <thead>
          <tr>
            <th class="py-2 border">Date</th>
            <th class="py-2 border">Time</th>
            <th class="py-2 border">Level</th>
            <th class="py-2 border">Location</th>
            <th class="py-2 border">Notes</th>
          </tr>
        </thead>
        <tbody id="entries"></tbody>
      </table>
    </div>

  </div>

  <script>
    const { createClient } = supabase;
    const supabaseClient = createClient('https://tcqnxkdnceekjdxafcbf.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRjcW54a2RuY2Vla2pkeGFmY2JmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2NTM1MzAsImV4cCI6MjA2NzIyOTUzMH0.K28ihjuXgGlUHQBzt7DmBQN4-NE4xcKe276tGwIF5Xc');
    let currentUser = null;

    async function loadUser() {
      const { data, error } = await supabaseClient.auth.getUser();
      if (error || !data.user) {
        window.location.href = '/billiard-tracker/index.html';
      }
      currentUser = data.user;
    }

    async function loadEntries() {
      const { data, error } = await supabaseClient.from('rds').select('*').eq('user_id', currentUser.id).order('date', { ascending: false });
      if (data) {
        const tbody = document.getElementById('entries');
        tbody.innerHTML = data.map(row => `
          <tr>
            <td class="py-1 border px-2">${row.date}</td>
            <td class="py-1 border px-2">${row.time}</td>
            <td class="py-1 border px-2">${row.level}</td>
            <td class="py-1 border px-2">${row.location}</td>
            <td class="py-1 border px-2">${row.notes}</td>
          </tr>
        `).join('');
      }
    }

    document.getElementById('rds-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const newEntry = {
        date: document.getElementById('date').value,
        time: document.getElementById('time').value,
        level: document.getElementById('level').value,
        location: document.getElementById('location').value,
        notes: document.getElementById('notes').value
      };

      const { error } = await supabaseClient.from('rds').insert([newEntry]);
      if (!error) {
        e.target.reset();
        loadEntries();
      } else {
        alert('Error adding entry: ' + error.message);
      }
    });

    loadUser().then(loadEntries);
  </script>
</body>
</html>
